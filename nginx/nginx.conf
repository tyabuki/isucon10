user  www-data;
worker_processes  auto;
worker_rlimit_nofile 262140;

error_log  /var/log/nginx/error.log warn;
pid        /run/nginx.pid;

events {
    worker_connections 65535;
    multi_accept on;
    use epoll;
}

http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    #log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
    #                 '$status $body_bytes_sent "$http_referer" '
    #                 '"$http_user_agent" "$http_x_forwarded_for"';
    log_format kataribe '$remote_addr - $remote_user [$time_local] "$request" $status $body_bytes_sent "$http_referer" "$http_user_agent" $request_time';

    access_log  /var/log/nginx/access.log  kataribe;
    #access_log off;

    keepalive_timeout 120;
    client_max_body_size 10m;
    #proxy_request_buffering on;
    #client_body_buffer_size 2048k;

    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    aio threads;
    open_file_cache max=1024 inactive=180s;
    open_file_cache_errors on;
    server_tokens off;

    gzip  off;
    #gzip  on;
    #gzip_vary on;
    #gzip_proxied any;
    #gzip_types text/plain text/css application/json application/javascript application/xml application/xml+rss;
    #gzip_static on;

    # 空だった
    #include /etc/nginx/conf.d/*.conf;

    # 統合した
    #include /etc/nginx/sites-enabled/*.conf;

    server {
         root /home/isucon/isuumo/webapp/public;
         listen 80 default_server;
         listen [::]:80 default_server;

         index index.php;

         location /api {
            try_files $uri /index.php$is_args$args;
         }

        location /initialize {
            try_files $uri /index.php$is_args$args;
        }

        location ~ \.php {
            try_files $uri =404;
            root           /home/isucon/isuumo/webapp/php/public;
            fastcgi_split_path_info ^(.+\.php)(/.+)$;
            include fastcgi_params;
            fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
            fastcgi_param SCRIPT_NAME $fastcgi_script_name;
            fastcgi_index index.php;
            fastcgi_pass 127.0.0.1:1323;
        }

        location / {
           index index.html;
           root /www/data;
           add_header Cache-Control "public";
           #access_log off;
           expires 24h;
        }

        location /api/estate/search/condition {
           add_header Cache-Control "public";
           expires 24h;
           default_type application/json;
           return 200 '{
  "doorWidth": {
    "prefix": "",
    "suffix": "cm",
    "ranges": [
      {
        "id": 0,
        "min": -1,
        "max": 80
      },
      {
        "id": 1,
        "min": 80,
        "max": 110
      },
      {
        "id": 2,
        "min": 110,
        "max": 150
      },
      {
        "id": 3,
        "min": 150,
        "max": -1
      }
    ]
  },
  "doorHeight": {
    "prefix": "",
    "suffix": "cm",
    "ranges": [
      {
        "id": 0,
        "min": -1,
        "max": 80
      },
      {
        "id": 1,
        "min": 80,
        "max": 110
      },
      {
        "id": 2,
        "min": 110,
        "max": 150
      },
      {
        "id": 3,
        "min": 150,
        "max": -1
      }
    ]
  },
  "rent": {
    "prefix": "",
    "suffix": "円",
    "ranges": [
      {
        "id": 0,
        "min": -1,
        "max": 50000
      },
      {
        "id": 1,
        "min": 50000,
        "max": 100000
      },
      {
        "id": 2,
        "min": 100000,
        "max": 150000
      },
      {
        "id": 3,
        "min": 150000,
        "max": -1
      }
    ]
  },
  "feature": {
    "list": [
      "最上階",
      "防犯カメラ",
      "ウォークインクローゼット",
      "ワンルーム",
      "ルーフバルコニー付",
      "エアコン付き",
      "駐輪場あり",
      "プロパンガス",
      "駐車場あり",
      "防音室",
      "追い焚き風呂",
      "オートロック",
      "即入居可",
      "IHコンロ",
      "敷地内駐車場",
      "トランクルーム",
      "角部屋",
      "カスタマイズ可",
      "DIY可",
      "ロフト",
      "シューズボックス",
      "インターネット無料",
      "地下室",
      "敷地内ゴミ置場",
      "管理人有り",
      "宅配ボックス",
      "ルームシェア可",
      "セキュリティ会社加入済",
      "メゾネット",
      "女性限定",
      "バイク置場あり",
      "エレベーター",
      "ペット相談可",
      "洗面所独立",
      "都市ガス",
      "浴室乾燥機",
      "インターネット接続可",
      "テレビ・通信",
      "専用庭",
      "システムキッチン",
      "高齢者歓迎",
      "ケーブルテレビ",
      "床下収納",
      "バス・トイレ別",
      "駐車場2台以上",
      "楽器相談可",
      "フローリング",
      "オール電化",
      "TVモニタ付きインタホン",
      "デザイナーズ物件"
    ]
  }
}';
        }

        location /api/chair/low_priced {
           default_type application/json;
           alias /home/isucon/isuumo/webapp/php/data/low_priced_chair.json;
        }

        location /api/estate/low_priced {
           default_type application/json;
           alias /home/isucon/isuumo/webapp/php/data/low_priced_estate.json;
        }

        location /api/chair/search/condition {
           add_header Cache-Control "public";
           expires 24h;
           default_type application/json;
           return 200 '{
  "height": {
    "prefix": "",
    "suffix": "cm",
    "ranges": [
      {
        "id": 0,
        "min": -1,
        "max": 80
      },
      {
        "id": 1,
        "min": 80,
        "max": 110
      },
      {
        "id": 2,
        "min": 110,
        "max": 150
      },
      {
        "id": 3,
        "min": 150,
        "max": -1
      }
    ]
  },
  "width": {
    "prefix": "",
    "suffix": "cm",
    "ranges": [
      {
        "id": 0,
        "min": -1,
        "max": 80
      },
      {
        "id": 1,
        "min": 80,
        "max": 110
      },
      {
        "id": 2,
        "min": 110,
        "max": 150
      },
      {
        "id": 3,
        "min": 150,
        "max": -1
      }
    ]
  },
  "depth": {
    "prefix": "",
    "suffix": "cm",
    "ranges": [
      {
        "id": 0,
        "min": -1,
        "max": 80
      },
      {
        "id": 1,
        "min": 80,
        "max": 110
      },
      {
        "id": 2,
        "min": 110,
        "max": 150
      },
      {
        "id": 3,
        "min": 150,
        "max": -1
      }
    ]
  },
  "price": {
    "prefix": "",
    "suffix": "円",
    "ranges": [
      {
        "id": 0,
        "min": -1,
        "max": 3000
      },
      {
        "id": 1,
        "min": 3000,
        "max": 6000
      },
      {
        "id": 2,
        "min": 6000,
        "max": 9000
      },
      {
        "id": 3,
        "min": 9000,
        "max": 12000
      },
      {
        "id": 4,
        "min": 12000,
        "max": 15000
      },
      {
        "id": 5,
        "min": 15000,
        "max": -1
      }
    ]
  },
  "color": {
    "list": [
      "黒",
      "白",
      "赤",
      "青",
      "緑",
      "黄",
      "紫",
      "ピンク",
      "オレンジ",
      "水色",
      "ネイビー",
      "ベージュ"
    ]
  },
  "feature": {
    "list": [
      "ヘッドレスト付き",
      "肘掛け付き",
      "キャスター付き",
      "アーム高さ調節可能",
      "リクライニング可能",
      "高さ調節可能",
      "通気性抜群",
      "メタルフレーム",
      "低反発",
      "木製",
      "背もたれつき",
      "回転可能",
      "レザー製",
      "昇降式",
      "デザイナーズ",
      "金属製",
      "プラスチック製",
      "法事用",
      "和風",
      "中華風",
      "西洋風",
      "イタリア製",
      "国産",
      "背もたれなし",
      "ラテン風",
      "布貼地",
      "スチール製",
      "メッシュ貼地",
      "オフィス用",
      "料理店用",
      "自宅用",
      "キャンプ用",
      "クッション性抜群",
      "モーター付き",
      "ベッド一体型",
      "ディスプレイ配置可能",
      "ミニ机付き",
      "スピーカー付属",
      "中国製",
      "アンティーク",
      "折りたたみ可能",
      "重さ500g以内",
      "24回払い無金利",
      "現代的デザイン",
      "近代的なデザイン",
      "ルネサンス的なデザイン",
      "アームなし",
      "オーダーメイド可能",
      "ポリカーボネート製",
      "フットレスト付き"
    ]
  },
  "kind": {
    "list": [
      "ゲーミングチェア",
      "座椅子",
      "エルゴノミクス",
      "ハンモック"
    ]
  }
}';
        }
    }
}
